<canvas id="spotlight-canvas" class="fixed inset-0 z-0 pointer-events-none opacity-0 transition-opacity duration-700"></canvas>

<style>
  #spotlight-canvas {
    /* Force hard edges for the retro look */
    image-rendering: pixelated; /* Chrome/Safari */
    image-rendering: crisp-edges; /* Firefox */
    width: 100vw;
    height: 100vh;
    mix-blend-mode: screen;
  }
</style>

<script>
  const canvas = document.getElementById('spotlight-canvas');
  // We need to type cast canvas since TS doesn't know it's an HTMLCanvasElement in a script tag without 'lang="ts"'
  // but in Astro scripts are modules. We'll access context safely.
  const ctx = canvas ? (canvas as HTMLCanvasElement).getContext('2d') : null;

  let isVisible = false;
  let mouseX = -1000;
  let mouseY = -1000;

  // Configuration for "Big Pixels"
  // The larger the number, the bigger the blocks
  const PIXEL_SIZE = 25;

  const resize = () => {
    if (!canvas) return;
    const cvs = canvas as HTMLCanvasElement;
    // Set low resolution for the retro effect
    cvs.width = Math.ceil(window.innerWidth / PIXEL_SIZE);
    cvs.height = Math.ceil(window.innerHeight / PIXEL_SIZE);
  };

  const updateMouse = (e) => {
    if (!canvas) return;

    if (!isVisible) {
      canvas.classList.remove('opacity-0');
      isVisible = true;
    }

    mouseX = e.clientX;
    mouseY = e.clientY;
  };

  const draw = () => {
    if (!canvas || !ctx) return;
    const cvs = canvas as HTMLCanvasElement;

    // Clear the canvas
    ctx.clearRect(0, 0, cvs.width, cvs.height);

    // Map screen coordinates to low-res canvas coordinates
    const x = mouseX / PIXEL_SIZE;
    const y = mouseY / PIXEL_SIZE;

    // Create gradient matching the original colors
    // Radius needs to be scaled down relative to pixel size
    // Original radius was ~1000px, so we scale it down
    const radius = 1000 / PIXEL_SIZE;

    const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);

    // Rich Gradient Palette
    gradient.addColorStop(0, 'rgba(29, 78, 216, 0.5)');    // Deep Blue
    gradient.addColorStop(0.2, 'rgba(139, 92, 246, 0.4)');  // Violet
    gradient.addColorStop(0.4, 'rgba(236, 72, 153, 0.3)');  // Magenta
    gradient.addColorStop(0.6, 'rgba(234, 179, 8, 0.1)');   // Gold
    gradient.addColorStop(0.8, 'transparent');             // Fade

    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, cvs.width, cvs.height);

    requestAnimationFrame(draw);
  };

  // Initialize
  if (canvas) {
    window.addEventListener('resize', resize);
    document.addEventListener('mousemove', updateMouse);
    resize();
    draw();
  }
</script>